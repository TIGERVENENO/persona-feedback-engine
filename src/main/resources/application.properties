spring.application.name=persona-feedback-engine

# ======== PostgreSQL Database Configuration ========
spring.datasource.url=jdbc:postgresql://localhost:5432/personadb
spring.datasource.username=postgres
spring.datasource.password=postgres
spring.datasource.driver-class-name=org.postgresql.Driver

# ======== Hibernate/JPA Configuration ========
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true

# ======== Flyway Configuration ========
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true

# ======== RabbitMQ Configuration ========
spring.rabbitmq.host=localhost
spring.rabbitmq.port=5672
spring.rabbitmq.username=guest
spring.rabbitmq.password=guest

# ======== Redis Configuration ========
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.password=${REDIS_PASSWORD:}

# ======== Cache Configuration ========
spring.cache.type=redis
spring.cache.redis.time-to-live=86400000

# ======== AI Provider Configuration ========
app.ai.provider=${AI_PROVIDER:agentrouter}

# ======== OpenRouter API Configuration ========
app.openrouter.api-key=${OPENROUTER_API_KEY:}
# Model examples: anthropic/claude-3-5-sonnet, openai/gpt-4o, mistral/mistral-large
# See https://openrouter.ai/docs#models for complete list
app.openrouter.model=${OPENROUTER_MODEL:anthropic/claude-3-5-sonnet}
app.openrouter.timeout-seconds=${OPENROUTER_TIMEOUT_SECONDS:30}
app.openrouter.retry-delay-ms=${OPENROUTER_RETRY_DELAY_MS:1000}

# ======== AgentRouter API Configuration ========
app.agentrouter.api-key=${AGENTROUTER_API_KEY:}
# Model examples: anthropic/claude-3-5-sonnet, openai/gpt-4o, mistral/mistral-large
# See https://agentrouter.ai/docs#models for complete list
app.agentrouter.model=${AGENTROUTER_MODEL:anthropic/claude-3-5-sonnet}
app.agentrouter.timeout-seconds=${AGENTROUTER_TIMEOUT_SECONDS:30}
app.agentrouter.retry-delay-ms=${AGENTROUTER_RETRY_DELAY_MS:1000}

# ======== AI Service Retry Configuration ========
app.ai.max-retries=${AI_MAX_RETRIES:3}
app.ai.retry-backoff-multiplier=${AI_RETRY_BACKOFF_MULTIPLIER:2}

# ======== HikariCP Connection Pool Configuration ========
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000
spring.datasource.hikari.auto-commit=true

# ======== RabbitMQ Performance Configuration ========
spring.rabbitmq.listener.simple.prefetch=10
spring.rabbitmq.listener.simple.concurrency=3
spring.rabbitmq.listener.simple.max-concurrency=10

# ======== Application-Specific Configuration ========
app.feedback.max-products-per-session=5
app.feedback.max-personas-per-session=5
app.feedback.max-prompt-length=2000

# ======== Actuator and Prometheus Configuration ========
management.endpoints.web.exposure.include=health,info,prometheus,metrics
management.metrics.export.prometheus.enabled=true
management.endpoint.prometheus.enabled=true
management.health.livenessState.enabled=true
management.health.readinessState.enabled=true

# ======== Resilience4j CircuitBreaker Configuration ========
resilience4j.circuitbreaker.configs.default.registerHealthIndicator=true
resilience4j.circuitbreaker.configs.default.failureRateThreshold=50.0
resilience4j.circuitbreaker.configs.default.slowCallRateThreshold=50.0
resilience4j.circuitbreaker.configs.default.slowCallDurationThreshold=30000
resilience4j.circuitbreaker.configs.default.permittedNumberOfCallsInHalfOpenState=3
resilience4j.circuitbreaker.configs.default.minimumNumberOfCalls=5
resilience4j.circuitbreaker.configs.default.automaticTransitionFromOpenToHalfOpenEnabled=true
resilience4j.circuitbreaker.configs.default.waitDurationInOpenState=20000
resilience4j.circuitbreaker.configs.default.recordExceptions=java.io.IOException,ru.tigran.personafeedbackengine.exception.AIGatewayException
resilience4j.circuitbreaker.instances.aiProvider.baseConfig=default

# ======== Graceful Shutdown Configuration ========
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=30s

# ======== CORS Configuration ========
cors.allowed-origins=http://localhost:3000,http://localhost:8080,http://localhost:5173

# ======== JWT Configuration ========
# Secret key for JWT signing (should be at least 32 characters for HS256)
# Change this in production!
app.jwt.secret-key=${JWT_SECRET_KEY:your-secret-key-please-change-this-in-production-at-least-32-chars}
app.jwt.expiration-hours=${JWT_EXPIRATION_HOURS:24}

# ======== Logging Configuration ========
logging.level.root=INFO
logging.level.ru.tigran.personafeedbackengine=DEBUG
logging.level.org.springframework.web=WARN
logging.level.org.hibernate.SQL=WARN
logging.level.org.springframework.security=INFO
