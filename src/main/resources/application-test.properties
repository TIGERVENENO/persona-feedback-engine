# ============================================================================
# Persona Feedback Engine - Test Configuration
# ============================================================================
# This profile is used when running unit and integration tests
# Uses H2 in-memory database for fast test execution
# ============================================================================

# ======== H2 Database Configuration (In-Memory) ========
spring.datasource.url=jdbc:h2:mem:testdb
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# ======== H2 Console (for debugging, optional) ========
spring.h2.console.enabled=false

# ======== Hibernate/JPA Configuration ========
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.defer-datasource-initialization=true

# ======== Flyway Configuration ========
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true

# ======== SQL Script Initialization ========
# Отключаем все встроенные скрипты инициализации
# Flyway управляет всей инициализацией БД (schema и данные)
spring.sql.init.mode=never
spring.sql.init.data-locations=classpath:/nonexistent

# ======== RabbitMQ Configuration (use in-memory for tests) ========
spring.rabbitmq.host=localhost
spring.rabbitmq.port=5672
spring.rabbitmq.username=guest
spring.rabbitmq.password=guest

# ======== Redis Configuration (embed for tests) ========
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.password=

# ======== Cache Configuration ========
spring.cache.type=simple

# ======== AI Provider Configuration ========
app.ai.provider=openrouter

# ======== OpenRouter API Configuration ========
app.openrouter.api-key=test-api-key
app.openrouter.model=deepseek/deepseek-r1-0528:free
app.openrouter.timeout-seconds=30
app.openrouter.retry-delay-ms=1000

# ======== AgentRouter API Configuration ========
app.agentrouter.api-key=test-api-key
app.agentrouter.model=deepseek/deepseek-v3.1
app.agentrouter.timeout-seconds=30
app.agentrouter.retry-delay-ms=1000

# ======== Application-Specific Configuration ========
app.feedback.max-products-per-session=5
app.feedback.max-personas-per-session=5
app.feedback.max-prompt-length=2000

# ======== JWT Configuration ========
app.jwt.secret-key=test-jwt-secret-key-for-testing-only-not-production
app.jwt.expiration-hours=24

# ======== Logging Configuration (quiet for tests) ========
logging.level.root=WARN
logging.level.ru.tigran.personafeedbackengine=INFO
logging.level.org.springframework.web=WARN
logging.level.org.hibernate.SQL=WARN
logging.level.org.springframework.test=WARN
